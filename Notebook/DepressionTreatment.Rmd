---
title: "Comparison of VR Based and Traditional Treatments of Depression on Males and Females Aged 18-80"
output: html_notebook
---

**Abstract:**

The Aim of this project is to determine whether, in treatment of depression in Males and Females aged 18-40, a VR-based method of treatment is more effective than a traditional CBT method of treatment.

To assess depression severity, the author of the Dataset has used self reporting to gather severity of depression in 200 patients. The patients were psychotherapy patients, male(95) and female(105) and fell between the ages of 18 to 40 years old. The patients were randomly assigned to participate in the traditional CBT method (Control group) or the VR-Based method (experimental.) The patients then used the Zung Self-Rating Depression Scale

**Introduction**

The immersive nature of VR could be useful in the non-pharmacutical treatment of depression in men and women. In this study we will compare the results from the data gathered to determine whether the data itself is useful, and whether it is true that an experimental VR treatment for depression is as effective or perhaps more effective than a traditional Cognitive Behavioural method of treatment.

If the data shows that participants who suffer with symptoms of depression experience more relief through VR based therapy, then it could be said that this is an effective method of treatment for these symptoms.

**Hypothesis**:

In men and women aged 10-40 who suffer with symptoms of depression, a VR based method of treatment is more effective than traditional method in relieving these symptoms of depression.

**Method**

There were 100 participants in the survey, all of whom were between the age of 18 and 40. There were 95 males and 105 female participants. The participants were divided to two equal groups, one of which used Cognitive Behavioural Therapy (The Control group) and the other which used VR based therapy (Experimental Group). The participants spent 50 minutes per week for the duration of 12 weeks with a therapist. The participants were asked to self report at the beginning and end of the study. The Zung Depression Scale was used. It is a 20-item sale which asks to report from 1 to 4 with 1 meaning a little of the time and 4 meaning most of the time. The scores ranged from 20 to80.

In this document, we will use statistical analysis to determine whether a difference can be observed between the treatment methods in men and in women.

**Results**

```{r Libraries}
# Load Packages
library(ggplot2)
library(tidyverse)
library(conflicted)
library(dplyr)
library(hmisc)
#Preference dplyr for conflicts
conflicts_prefer(dplyr::filter)
```

```{r Import_Data_Set}
#Define Dataset
depression_data <- read.csv("C:/Users/Ruth/Desktop/Ca1_RuthC/RC_Data_CA1/Data/participants_data_final.csv")

# Inspect the structure of the Data
str(data)

# Summarise statistics of CSV data
summary(data)

# Check data for missing or null values
sum(is.na(data)) # Total of missing values
colSums(is.na(data)) # Missing values in each column

# Check structure of data once more
str(data)

# Check for duplicate rows
sum(duplicated(data))

# Check each column has the correct data type
sapply(data, class)

# convert 'group' and 'gender' from character to factors for easier analysis
data$Group <- as.factor(data$Group)
data$Gender <- as.factor(data$Gender)

#Check data once more
sapply(data, class)

# Get summary statistics to show no character strings
summary(data)
```

We start by loading the CSV file with participant data about their treatment group and their depression scores.After running data cleaning code the only discrepancy found was that the group and gender columns were labelled as character strings. However it would be better practice to convert these to factors. Since the Group and Gender categories are considered variables, factors would be a more accurate mode of statistical analysis for these variables. 

```{r Summary_Data}


# Calculate summary statistics
summary_data <- depression_data %>%
  pivot_longer(
    cols = c(Pre_Treatment_Score, Post_Treatment_Score),
    names_to = "Treatment_Phase",    # New column: "Pre_Treatment" or "Post_Treatment"
    values_to = "Score"              # Column for scores
  ) %>%
  group_by(Group, Treatment_Phase) %>%
  summarise(
    Mean_Score = mean(Score, na.rm = TRUE),
    SE = sd(Score, na.rm = TRUE) / sqrt(n()),        # SE Standard Error
    Lower_CI = Mean_Score - qt(0.975, df = n() - 1) * SE,  # Lower 95% CI
    Upper_CI = Mean_Score + qt(0.975, df = n() - 1) * SE,   # Upper 95% CI
    .groups = "drop"
  )

```

Using The Zung Depression Scale, we defined levels of severity of depression as variables and used this to visualise the level of severity pre and post-treatment for the Control and Experimental groups. We can see from this data that there are no severe cases of depression for either of the treatment methods post-treatment. More participants in both groups can be categorised as having normal levels of depression post-treatment. It can be noted that there is a significant change in the number of participants who underwent the Experimental treatment who fall under the normal category of depression after having received treatment.

```{r Pre_Treatment_Severity}

depression_data <- depression_data %>%
  mutate(Severity = case_when(
    Pre_Treatment_Score <= 44 ~ "Normal",
    Pre_Treatment_Score <= 59 ~ "Mild",
    Pre_Treatment_Score <= 69 ~ "Moderate",
    Pre_Treatment_Score > 70 ~ "Severe",
    ))

#Create Table
severity_table <- depression_data %>%
  count(Severity) %>%
  arrange(desc(n))
severity_table <- severity_table %>%
  mutate(Percentage = n / sum(n) * 100)

#Group By Treatment
severity_by_treatment <- depression_data %>%
  group_by(Group, Severity) %>%
  summarise(Frequency = n(), .groups = "drop") %>%
  mutate(Percentage = Frequency / sum(Frequency) * 100)
print(severity_by_treatment)

#Plot Data
ggplot(severity_by_treatment, aes(x = Severity, y = Frequency, fill = Group)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(
    values = c("Control (CBT)" = "dodgerblue1", "Experimental (VR)" ="orange")) +
  labs(
    title = "Pre-Treatment Depression Severity",
    x = "Severity Level",
    y = "Frequency",
    fill = "Treatment Type"
  ) +
  theme_minimal()
```

```{r Post_Treatment_Severity}

depression_data <- depression_data %>%
  mutate(Severity = case_when(
    Post_Treatment_Score <= 44 ~ "Normal",
    Post_Treatment_Score <= 59 ~ "Mild",
    Post_Treatment_Score <= 69 ~ "Moderate",
    Post_Treatment_Score > 70 ~ "Severe",
    ))

#Create Table
severity_table <- depression_data %>%
  count(Severity) %>%
  arrange(desc(n))
severity_table <- severity_table %>%
  mutate(Percentage = n / sum(n) * 100)

#Group By Treatment
severity_by_treatment <- depression_data %>%
  group_by(Group, Severity) %>%
  summarise(Frequency = n(), .groups = "drop") %>%
  mutate(Percentage = Frequency / sum(Frequency) * 100)
print(severity_by_treatment)

#Plot Data
ggplot(severity_by_treatment, aes(x = Severity, y = Frequency, fill = Group)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(
    values = c("Control (CBT)" = "dodgerblue1", "Experimental (VR)" ="orange")) +
  labs(
    title = "Post-Treatment Depression Severity",
    x = "Severity Level",
    y = "Frequency",
    fill = "Treatment Type"
  ) +
  theme_minimal()


```

j

```{r Comparing_Pre_And_Post_Treatment_Scores_By_Gender_And_Treatment_Type}


# Change to Long Format
long_data <- depression_data %>%
  pivot_longer(
    cols = c(Pre_Treatment_Score, Post_Treatment_Score),
    names_to = "Score_Type",    # New column indicating "Pre" or "Post"
    values_to = "Score"         # Column for scores
  )

#BoxPlot
ggplot(long_data, aes(x = interaction(Gender, Score_Type), y = Score, fill = Group)) +
  geom_boxplot(alpha = 0.5) +
  labs(
    title = "Pre and Post Treatment Scores by Gender and Group",
    x = "Gender and Score Type",
    y = "Score",
    fill = "Group"
  ) +
  theme_minimal() +
  scale_x_discrete(labels = c("Male Pre" = "Male (Pre)", "Male Post" = "Male (Post)",
                              "Female Pre" = "Female (Pre)", "Female Post" = "Female (Post)"))+
  scale_fill_manual(values = c("dodgerblue1", "orange"))


```

Overall, female participants experienced the greater change in depression symptoms. Notably, the females who participated in the experimental treatment had the greatest change in score on the Zung Depression Scale.

```{r Average_Change_In_Score_By_Gender_And_Treatment_Group}


ggplot(depression_data, aes(x = interaction(Gender, Group), y = Change_in_Score, fill = Group)) +
  stat_summary(fun = mean, geom = "bar", position = position_dodge(), width = 0.7) +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", position = position_dodge(0.7), width = 0.2) +
  labs(
    title = "Average Change in Score by Gender and Treatment Group",
    x = "Gender and Treatment Group",
    y = "Average Change in Score",
    fill = "Treatment Group"
  ) +
  theme_minimal() +
  scale_x_discrete(labels = c("Male.Control" = "Male (Control)", "Male.Experimental" = "Male (Experimental)",
                              "Female.Control" = "Female (Control)", "Female.Experimental" = "Female (Experimental)"))+
  scale_fill_manual(values = c("dodgerblue1", "orange"))



```

```{r Relationship_Between_Initial_Scores_And_Change_After_Treatment}
ggplot(depression_data, aes(x = Pre_Treatment_Score, y = Post_Treatment_Score, color = Group)) +
  geom_point(size = 3, alpha = 0.7) +
  geom_smooth(method = "lm", se = FALSE, size = 1) +
  labs(
    title = "Relationship Between Initial Scores and Change After Treatment",
    x = "Initial Depression Score",
    y = "Post Treatment Score",
    color = "Treatment Group"
  ) +
  theme_minimal() +
  facet_wrap(~ Group) +
  scale_color_manual(values = c("dodgerblue1", "orange"))

```

```{r Mean_Depression_Scores_Pre_VS_Post_Treatment}
#Pre Treatment Histogram
ggplot(summary_data, aes(x = Treatment_Phase, y = Mean_Score, color = Group, group = Group)) +
  geom_point(size = 4, position = position_dodge(0.2)) +  # Add points for means
  geom_errorbar(
    aes(ymin = Lower_CI, ymax = Upper_CI),
    width = 0.2, size = 1, position = position_dodge(0.2)
  ) +
  geom_line(position = position_dodge(0.2)) +  # Connect points with lines
  labs(
    title = "95% Confidence Intervals for Depression Scores",
    x = "Treatment Phase",
    y = "Mean Depression Score",
    color = "Treatment Group"
  ) +
  theme_minimal() +
  scale_color_manual(values = c("dodgerblue1", "orange")) +
  scale_x_discrete(labels = c("Pre_Treatment_Score" = "Pre-Treatment", "Post_Treatment_Score" = "Post-Treatment"))
```

**Discussion**

In females it can be said that the experimental method alleviates the symptoms of depression more efficiently than the traditional method. In males both methods have a lesser effect, however the experimental method does have a slightly better effect at alleviating the symptoms of depression. Therefor the hypothesis is true for males and females.

```{r}
# T-test for pre-treatment scores
t_test_pre <- t.test(Pre_Treatment_Score ~ Group, data = data)

# Show results of the t-test
summary(t_test_pre)
```

This summary of t-test for pre-treatment scores will have the t-value, p-value, and confidence intervals. If the p-value is less than 0.05 then there is a significant difference between the two groups before treatment.
```{r}
# Create variable for (Post - Pre) called Change_in_Score
data$Change_in_score <- data$Post_Treatment_Score - data$Pre_Treatment_Score
```

We then performed an independent t-test to compare the post-treatment scores between the two groups. This helps us assess if the depression scores have changed much between the two groups after the treatment. The results will tell us if there's a significant difference in post-treatment depression scores between the two groups.
```{r}
# Create variable for (Post - Pre) called Change_in_Score
data$Change_in_score <- data$Post_Treatment_Score - data$Pre_Treatment_Score
```

To test the change in depression scores for each participant, we created a new variable called Change_in_Score. This variable shows the difference between post-treatment and pre-treatment scores. By making this variable we can apply paired t-tests to view the within-group changes in depression scores.
```{r}
# Paired t-test for control group (CBT)
paired_t_test_control <- t.test(data$Pre_Treatment_Score[data$Group == "Control (CBT)"], 
                                data$Post_Treatment_Score[data$Group == "Control (CBT)"], 
paired = TRUE)

# Show the results for the control group
summary(paired_t_test_control)
```

Next we ran a paired t-test on the Control Group (CBT). This test compares pre-treatment and post-treatment scores for participants in the control group to see if their depression scores have changed significantly over time. The summary output will provide information on the t-value, p-value, and confidence intervals for the change in  scores in the control group.
```{r}
# Paired t-test for experimental group (VR)
paired_t_test_experimental <- t.test(data$Pre_Treatment_Score[data$Group == "Experimental (VR)"], 
                                     data$Post_Treatment_Score[data$Group == "Experimental (VR)"], 
                                     paired = TRUE)

# Show the results of the Experimental Group
summary(paired_t_test_experimental)
```

We also created a similar paired t-test for the Experimental Group (VR). This test tells us if there's a significant change in depression scores from pre-treatment to post-treatment for the participants in the VR group. The results of this paired t-test will show if the VR treatment significantly lowered depression scores in the experimental group.


**Conclusion of t-tests**

Looking at the results of these t-tests, we can determine whether there were any significant differences in depression scores between the control (CBT) and experimental (VR) groups at both the pre-treatment and post-treatment stages. Also, the paired t-tests allow us to assess the effectiveness of the treatment for each group by comparing pre-treatment and post-treatment scores within both groups.
